<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PokeMonster</title>
    <style>
        html, body{
            overflow: hidden;
            width:100%;
            height:100%;
            margin:0;
            padding:0;
            border:0;
        }
    </style>
    <script src="js/ImageManager.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/world.js"></script>
    <script src="js/MapRenderer.js"></script>
    <script>
        var canvas;
        var ctx;
        var imageManager;
        var mapRenderer;
        var speed = 100;
        var moveX = 0;
        var moveY = 0;

        var images = {
            "house" : "img/house.png",
            "outside" : "img/outside.png",
            "outside2" : "img/outside2.png"
        };
        function init(){
            imageManager = new ImageManager();
            imageManager.load(images, onLoaded);

            canvas = initFullScreenCanvas("mainCanvas");
            ctx = canvas.getContext("2d");

            /*
             Left Arrow 	37
             Up Arrow 	38
             Right Arrow 	39
             Dw Arrow 	40
             */
           window.onkeydown = function (e) {
                if(e.keyCode == 38){
                    mapRenderer.move(moveX, speed);
                }else if (e.keyCode == 40){
                    mapRenderer.move(moveX,-speed);
                }else if (e.keyCode == 37){
                    mapRenderer.move( speed, moveY);
                }else if (e.keyCode ==39){
                    mapRenderer.move(-speed, moveY);
                };
            };
        }

        //图像加载完后回调;
        function onLoaded(){
            mapRenderer = new MapRenderer(world, imageManager.get("outside2"),32,canvas.width,canvas.height);
            animate(0);
        }

        function animate(t){
            clear();
            mapRenderer.draw(ctx);
            requestAnimationFrame(arguments.callee);
        }

 /*       function onMove(){
            console.log(moveX+","+moveY);
            mapRenderer.move(moveX, moveY);
        }*/

        function clear(){
            //填充画布
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width , canvas.height);
        }
        function  initFullScreenCanvas(canvasId){
            var canvas = document.getElementById(canvasId);
            resizeCanvas(canvas);
            window.addEventListener("resize" , function () {
                resizeCanvas(canvas);
            });
            return canvas;
        }

        function resizeCanvas(canvas){
            canvas.width = document.width || document.body.clientWidth;
            canvas.height = document.height || document.body.clientHeight;
            mapRenderer && mapRenderer.setViewportSize(canvas.width , canvas.height);
        }
    </script>
</head>
<body onload="init()">
    <canvas id="mainCanvas" width="400" height="300" ></canvas>
</body>
</html>